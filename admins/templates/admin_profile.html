{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Profile - Admin{% endblock %}

{% block breadcrumb %}My Profile{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Profile Information -->
        <div class="col-lg-8">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-circle me-2"></i>Profile Information
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{% url 'admin_profile' %}">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="update_profile">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="first_name" class="form-label fw-bold">First Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="first_name" name="first_name" value="{{ admin.first_name }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="middle_name" class="form-label fw-bold">Middle Name</label>
                                <input type="text" class="form-control" id="middle_name" name="middle_name" value="{{ admin.middle_name|default:'' }}">
                            </div>
                        </div>

                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="last_name" class="form-label fw-bold">Last Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="last_name" name="last_name" value="{{ admin.last_name }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="suffix" class="form-label fw-bold">Suffix</label>
                                <input type="text" class="form-control" id="suffix" name="suffix" value="{{ admin.suffix|default:'' }}" placeholder="Jr., Sr., III, etc.">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="phone" class="form-label fw-bold">Phone Number <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="phone" name="phone_number" value="{{ admin.phone_number }}" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="username" class="form-label fw-bold">Username <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="username" name="username" value="{{ admin.username }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label fw-bold">Email <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="email" name="email" value="{{ admin.email }}" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="department" class="form-label fw-bold">Department <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="department" name="department" value="{{ admin.department }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="position" class="form-label fw-bold">Position <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="position" name="position" value="{{ admin.position }}" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Role</label>
                                <input type="text" class="form-control" value="{{ admin.get_role_display }}" readonly disabled>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Status</label>
                                <input type="text" class="form-control" value="{% if admin.is_active %}Active{% else %}Inactive{% endif %}" readonly disabled>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save me-2"></i>Update Profile
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle me-2"></i>Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Profile Summary Sidebar -->
        <div class="col-lg-4">
            <!-- Profile Summary Card -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                            <i class="bi bi-person-circle text-primary" style="font-size: 4rem;"></i>
                        </div>
                    </div>
                    <h5 class="mb-1">{{ admin.get_full_name }}</h5>
                    <p class="text-muted mb-0">{{ admin.position }}</p>
                    <p class="text-muted small">{{ admin.department }}</p>
                    <div class="mt-3">
                        <span class="badge bg-primary">{{ admin.get_role_display }}</span>
                        {% if admin.is_active %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-danger">Inactive</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Account Details Card -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Account Details</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">Username</small>
                        <strong>{{ admin.username }}</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Email</small>
                        <strong>{{ admin.email }}</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Created At</small>
                        <strong>{{ admin.created_at|date:"M d, Y" }}</strong>
                    </div>
                    <div>
                        <small class="text-muted d-block">Last Updated</small>
                        <strong>{{ admin.updated_at|date:"M d, Y h:i A" }}</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Section -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="bi bi-shield-lock me-2"></i>Change Password
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Password Requirements:</strong> Password must be at least 8 characters long.
                    </div>

                    <form method="POST" action="{% url 'admin_profile' %}" id="passwordForm">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="change_password">
                        
                        <div class="mb-3">
                            <label for="current_password" class="form-label fw-bold">Current Password <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="current_password" name="current_password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('current_password')">
                                    <i class="bi bi-eye" id="current_password_icon"></i>
                                </button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="new_password" class="form-label fw-bold">New Password <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="new_password" name="new_password" minlength="8" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password')">
                                    <i class="bi bi-eye" id="new_password_icon"></i>
                                </button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="confirm_password" class="form-label fw-bold">Confirm New Password <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" minlength="8" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm_password')">
                                    <i class="bi bi-eye" id="confirm_password_icon"></i>
                                </button>
                            </div>
                            <div id="password_match_message" class="form-text"></div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-warning" id="changePasswordBtn">
                                <i class="bi bi-shield-check me-2"></i>Change Password
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle me-2"></i>Clear
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Toggle password visibility
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '_icon');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
    }
}

// Check password match
document.getElementById('confirm_password').addEventListener('keyup', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    const messageDiv = document.getElementById('password_match_message');
    const submitBtn = document.getElementById('changePasswordBtn');
    
    if (confirmPassword.length === 0) {
        messageDiv.textContent = '';
        submitBtn.disabled = false;
        return;
    }
    
    if (newPassword === confirmPassword) {
        messageDiv.textContent = '✓ Passwords match';
        messageDiv.className = 'form-text text-success';
        submitBtn.disabled = false;
    } else {
        messageDiv.textContent = '✗ Passwords do not match';
        messageDiv.className = 'form-text text-danger';
        submitBtn.disabled = true;
    }
});

// Validate password form
document.getElementById('passwordForm').addEventListener('submit', function(e) {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (newPassword !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
    }
});
</script>

<style>
.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}